# Задание на стажировку Авито

## Императивно принятые решения

1. Так как в Swagger указан явно произвольный формат идентификаторов пользователей (можно увидеть по примеру запроса в API),
пришлось создать отдельное поле для внешнего ID (`ExternalID`), чтобы можно было адресоваться.
2. Было принято решение генерировать Swagger по коду, так как были добавлены новые конечные точки (для того чтобы не делать ручную работу).
3. Было принято решение писать только E2E тесты так как наличие тестов для всех слоёв означает дублирование логики.
4. Небольшое описание архитектуры (вошли-вышли, приключение на 20 минут):

Слой UseCase объединяет работу с несколькими репозиториями, один репозиторий отвечает за одну сущность в БД 
(при этом если сущность это join таблица, свойственная отношению многие ко многим, она тоже получает свой репозиторий).

В проекте используется менеджер транзакций для более простой работы с транзакциями, а также применяется паттерн 
Graceful Shutdown реализованный через App.

5. Используется конфигурация в yaml формате, потому что более свойственная конфигурация для сред вроде k8s.
6. Миграции стартуют при запуске сервиса и делаются самим сервисом - тут можно подискутировать как лучше, потому что шанс 
что-то поломать в данном случае проще, но не нужно возиться с лишним контейнером который апнет миграции или чем-то подобным.
7. Используется Fiber - он держит нагрузку лучше, чем стандартный `net/http`, ЕМНИП.

## Дополнительные задания

1. Нагрузочное тестирование **не** проверено - скорее всего не работает, но наработки в [loadtest](loadtest).
2. E2E тесты работают (но нет гарантии, что они не flaky).
3. Конфигурация линтера в [`.golangci.yml`](./.golangci.yml)
4. Есть ручка подсчёта статистики по PR-ам (`/statistics/get`), см [сгенерированную спеку](etc/api/swagger.yaml).
5. Нету батчовой ручки деактивации (не успел сделать).

## Потенциальные моменты для улучшения

1. Стоит проверить, как работает extension для k6 который позволяет гонять нагрузочные тесты описанные в Go.
2. CI/CD (было вне скоупа работы отчасти).
3. Слишком толстая конфигурация линтера.
4. Попытаться устранить дублирование моделей.
5. Довести пакет логгера до ума
6. Метрики/трейсы - сделать какую-то разумную обёртку, которая позволит одной функцией высшего порядка докинуть как 
какие-то метрики, так и трейсы (по аналогии с лейблами в pprof - они тоже пригодились бы).
7. Убрать все маты линтера.
8. Фоновый движок для подсчёта статистики (`/statistics/get`) - ручка содержит слишком много вычислений в себе.
9. Подразумевается что конфиг с дефолтными значениями (docker.yml) будет перезаписан при развёртывании, либо актуальный 
конфиг прокинут через параметры (см. docker-compose.yml). Лучше поменять на `.env`.
10. Гит хуки используя lefthook помогут сделать проверку линтинга ещё до коммита менее ручной.